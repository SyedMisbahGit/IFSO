<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFSO - Security Alerts</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <h1>Security Alerts</h1>
        <nav class="navbar">
            <a href="/">Dashboard</a>
            <a href="/live_traffic">Live Traffic</a>
            <a href="/alerts_page" class="active">Alerts</a>
            </nav>

        <div class="alerts-display">
            <h2>Real-time Security Alerts</h2>
            <div id="alert-logs" class="log-output"></div>
        </div>
    </div>

    <script type="text/javascript">
        // Connect to the /alerts namespace
        var socket = io.connect('http://' + document.domain + ':' + location.port + '/alerts');

        socket.on('connect', function() {
            console.log('Connected to alerts stream!');
        });

        socket.on('new_alert', function(alert) {
            const alertLogsDiv = document.getElementById('alert-logs');
            const div = document.createElement('div');
            div.className = `log-entry alert severity-${alert.severity.toLowerCase()}`;
            div.innerHTML = `<strong>ðŸš¨ ALERT [${alert.timestamp}]</strong><br>
                             Type: ${alert.attack_type} (Severity: ${alert.severity})<br>
                             From: ${alert.src_ip} (${alert.geo}) To: ${alert.dst_ip}<br>
                             Suggestion: ${alert.suggestion}<br>
                             Payload: ${alert.payload_snippet}`;

            // Prepend new alerts to the top, but manage a max display limit
            if (alertLogsDiv.children.length >= {{ MAX_WEB_LOGS }}) { // Use Flask variable
                alertLogsDiv.removeChild(alertLogsDiv.lastChild);
            }
            alertLogsDiv.prepend(div);
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from alerts stream.');
        });
    </script>
</body>
</html>